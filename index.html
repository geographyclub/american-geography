<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>American Geography</title>

<!-- load scripts -->
<script
  src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
  integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="
  crossorigin=""></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
  integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
  crossorigin=""></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
<script src="js/Leaflet.NavBar-master/src/Leaflet.NavBar.js"></script>

<!-- load styles -->
<link href="https://fonts.googleapis.com/css?family=Montserrat:600,900" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,700" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
  crossorigin=""/>
<link rel="stylesheet" href="js/Leaflet.NavBar-master/src/Leaflet.NavBar.css"></link>
<link rel="stylesheet" href="style.css">

</head>
<body>

<div id="map"></div>
<div id="title"><h1>AMERICAN GEOGRAPHY</h1></div>
<div id="subtitle"><h2>SUBTITLE</h2></div>


<!-- start scripts -->
<script>
// create map
var map;

function map(){
  map = L.map('map', {maxZoom:18});
  map.setMaxBounds([[-90, -180], [90, 180]]);
  map.setMinZoom(map.getBoundsZoom([[25, -128], [55, -68]], false));
  map.setView([39, -98], 1);

  // featuregroups
  var feature_cover = new L.featureGroup();
  var feature_quartile = new L.featureGroup();

  // get random file
  const columns = ["dp02_0001pe","dp02_0002pe","dp02_0003pe","dp02_0004pe","dp02_0005pe","dp02_0006pe","dp02_0007pe","dp02_0008pe","dp02_0009pe","dp02_0010pe","dp02_0011pe","dp02_0012pe","dp02_0013pe","dp02_0014pe","dp02_0015pe","dp02_0016pe","dp02_0017pe","dp02_0018pe","dp02_0019pe","dp02_0020pe","dp02_0021pe","dp02_0022pe","dp02_0023pe","dp02_0024pe","dp02_0025pe","dp02_0026pe","dp02_0027pe","dp02_0028pe","dp02_0029pe","dp02_0030pe","dp02_0031pe","dp02_0032pe","dp02_0033pe","dp02_0034pe","dp02_0035pe","dp02_0036pe","dp02_0037pe","dp02_0038pe","dp02_0039pe","dp02_0040pe","dp02_0041pe","dp02_0042pe","dp02_0043pe","dp02_0044pe","dp02_0045pe","dp02_0046pe","dp02_0047pe","dp02_0048pe","dp02_0049pe","dp02_0050pe","dp02_0051pe","dp02_0052pe","dp02_0053pe","dp02_0054pe","dp02_0055pe","dp02_0056pe","dp02_0057pe","dp02_0058pe","dp02_0059pe","dp02_0060pe","dp02_0061pe","dp02_0062pe","dp02_0063pe","dp02_0064pe","dp02_0065pe","dp02_0066pe","dp02_0067pe","dp02_0068pe","dp02_0069pe","dp02_0070pe","dp02_0071pe","dp02_0072pe","dp02_0073pe","dp02_0074pe","dp02_0075pe","dp02_0076pe","dp02_0077pe","dp02_0078pe","dp02_0079pe","dp02_0080pe","dp02_0081pe","dp02_0082pe","dp02_0083pe","dp02_0084pe","dp02_0085pe","dp02_0086pe","dp02_0087pe","dp02_0088pe","dp02_0089pe","dp02_0090pe","dp02_0091pe","dp02_0092pe","dp02_0093pe","dp02_0094pe","dp02_0095pe","dp02_0096pe","dp02_0097pe","dp02_0098pe","dp02_0099pe","dp02_0100pe","dp02_0101pe","dp02_0102pe","dp02_0103pe","dp02_0104pe","dp02_0105pe","dp02_0106pe","dp02_0107pe","dp02_0108pe","dp02_0109pe","dp02_0110pe","dp02_0111pe","dp02_0112pe","dp02_0113pe","dp02_0114pe","dp02_0115pe","dp02_0116pe","dp02_0117pe","dp02_0118pe","dp02_0119pe","dp02_0120pe","dp02_0121pe","dp02_0122pe","dp02_0123pe","dp02_0124pe","dp02_0125pe","dp02_0126pe","dp02_0127pe","dp02_0128pe","dp02_0129pe","dp02_0130pe","dp02_0131pe","dp02_0132pe","dp02_0133pe","dp02_0134pe","dp02_0135pe","dp02_0136pe","dp02_0137pe","dp02_0138pe","dp02_0139pe","dp02_0140pe","dp02_0141pe","dp02_0142pe","dp02_0143pe","dp02_0144pe","dp02_0145pe","dp02_0146pe","dp02_0147pe","dp02_0148pe","dp02_0149pe","dp02_0150pe","dp02_0151pe","dp02_0152pe","dp02_0153pe","dp02_0154pe","dp03_0001pe","dp03_0002pe","dp03_0003pe","dp03_0004pe","dp03_0005pe","dp03_0006pe","dp03_0007pe","dp03_0008pe","dp03_0009pe","dp03_0010pe","dp03_0011pe","dp03_0012pe","dp03_0013pe","dp03_0014pe","dp03_0015pe","dp03_0016pe","dp03_0017pe","dp03_0018pe","dp03_0019pe","dp03_0020pe","dp03_0021pe","dp03_0022pe","dp03_0023pe","dp03_0024pe","dp03_0025pe","dp03_0026pe","dp03_0027pe","dp03_0028pe","dp03_0029pe","dp03_0030pe","dp03_0031pe","dp03_0032pe","dp03_0033pe","dp03_0034pe","dp03_0035pe","dp03_0036pe","dp03_0037pe","dp03_0038pe","dp03_0039pe","dp03_0040pe","dp03_0041pe","dp03_0042pe","dp03_0043pe","dp03_0044pe","dp03_0045pe","dp03_0046pe","dp03_0047pe","dp03_0048pe","dp03_0049pe","dp03_0050pe","dp03_0051pe","dp03_0052pe","dp03_0053pe","dp03_0054pe","dp03_0055pe","dp03_0056pe","dp03_0057pe","dp03_0058pe","dp03_0059pe","dp03_0060pe","dp03_0061pe","dp03_0062pe","dp03_0063pe","dp03_0064pe","dp03_0065pe","dp03_0066pe","dp03_0067pe","dp03_0068pe","dp03_0069pe","dp03_0070pe","dp03_0071pe","dp03_0072pe","dp03_0073pe","dp03_0074pe","dp03_0075pe","dp03_0076pe","dp03_0077pe","dp03_0078pe","dp03_0079pe","dp03_0080pe","dp03_0081pe","dp03_0082pe","dp03_0083pe","dp03_0084pe","dp03_0085pe","dp03_0086pe","dp03_0087pe","dp03_0088pe","dp03_0089pe","dp03_0090pe","dp03_0091pe","dp03_0092pe","dp03_0093pe","dp03_0094pe","dp03_0095pe","dp03_0096pe","dp03_0097pe","dp03_0098pe","dp03_0099pe","dp03_0100pe","dp03_0101pe","dp03_0102pe","dp03_0103pe","dp03_0104pe","dp03_0105pe","dp03_0106pe","dp03_0107pe","dp03_0108pe","dp03_0109pe","dp03_0110pe","dp03_0111pe","dp03_0112pe","dp03_0113pe","dp03_0114pe","dp03_0115pe","dp03_0116pe","dp03_0117pe","dp03_0118pe","dp03_0119pe","dp03_0120pe","dp03_0121pe","dp03_0122pe","dp03_0123pe","dp03_0124pe","dp03_0125pe","dp03_0126pe","dp03_0127pe","dp03_0128pe","dp03_0129pe","dp03_0130pe","dp03_0131pe","dp03_0132pe","dp03_0133pe","dp03_0134pe","dp03_0135pe","dp03_0136pe","dp03_0137pe","dp04_0001pe","dp04_0002pe","dp04_0003pe","dp04_0004pe","dp04_0005pe","dp04_0006pe","dp04_0007pe","dp04_0008pe","dp04_0009pe","dp04_0010pe","dp04_0011pe","dp04_0012pe","dp04_0013pe","dp04_0014pe","dp04_0015pe","dp04_0016pe","dp04_0017pe","dp04_0018pe","dp04_0019pe","dp04_0020pe","dp04_0021pe","dp04_0022pe","dp04_0023pe","dp04_0024pe","dp04_0025pe","dp04_0026pe","dp04_0027pe","dp04_0028pe","dp04_0029pe","dp04_0030pe","dp04_0031pe","dp04_0032pe","dp04_0033pe","dp04_0034pe","dp04_0035pe","dp04_0036pe","dp04_0037pe","dp04_0038pe","dp04_0039pe","dp04_0040pe","dp04_0041pe","dp04_0042pe","dp04_0043pe","dp04_0044pe","dp04_0045pe","dp04_0046pe","dp04_0047pe","dp04_0048pe","dp04_0049pe","dp04_0050pe","dp04_0051pe","dp04_0052pe","dp04_0053pe","dp04_0054pe","dp04_0055pe","dp04_0056pe","dp04_0057pe","dp04_0058pe","dp04_0059pe","dp04_0060pe","dp04_0061pe","dp04_0062pe","dp04_0063pe","dp04_0064pe","dp04_0065pe","dp04_0066pe","dp04_0067pe","dp04_0068pe","dp04_0069pe","dp04_0070pe","dp04_0071pe","dp04_0072pe","dp04_0073pe","dp04_0074pe","dp04_0075pe","dp04_0076pe","dp04_0077pe","dp04_0078pe","dp04_0079pe","dp04_0080pe","dp04_0081pe","dp04_0082pe","dp04_0083pe","dp04_0084pe","dp04_0085pe","dp04_0086pe","dp04_0087pe","dp04_0088pe","dp04_0089pe","dp04_0090pe","dp04_0091pe","dp04_0092pe","dp04_0093pe","dp04_0094pe","dp04_0095pe","dp04_0096pe","dp04_0097pe","dp04_0098pe","dp04_0099pe","dp04_0100pe","dp04_0101pe","dp04_0102pe","dp04_0103pe","dp04_0104pe","dp04_0105pe","dp04_0106pe","dp04_0107pe","dp04_0108pe","dp04_0109pe","dp04_0110pe","dp04_0111pe","dp04_0112pe","dp04_0113pe","dp04_0114pe","dp04_0115pe","dp04_0116pe","dp04_0117pe","dp04_0118pe","dp04_0119pe","dp04_0120pe","dp04_0121pe","dp04_0122pe","dp04_0123pe","dp04_0124pe","dp04_0125pe","dp04_0126pe","dp04_0127pe","dp04_0128pe","dp04_0129pe","dp04_0130pe","dp04_0131pe","dp04_0132pe","dp04_0133pe","dp04_0134pe","dp04_0135pe","dp04_0136pe","dp04_0137pe","dp04_0138pe","dp04_0139pe","dp04_0140pe","dp04_0141pe","dp04_0142pe","dp04_0143pe","dp05_0001pe","dp05_0002pe","dp05_0003pe","dp05_0004pe","dp05_0005pe","dp05_0006pe","dp05_0007pe","dp05_0008pe","dp05_0009pe","dp05_0010pe","dp05_0011pe","dp05_0012pe","dp05_0013pe","dp05_0014pe","dp05_0015pe","dp05_0016pe","dp05_0017pe","dp05_0018pe","dp05_0019pe","dp05_0020pe","dp05_0021pe","dp05_0022pe","dp05_0023pe","dp05_0024pe","dp05_0025pe","dp05_0026pe","dp05_0027pe","dp05_0028pe","dp05_0029pe","dp05_0030pe","dp05_0031pe","dp05_0032pe","dp05_0033pe","dp05_0034pe","dp05_0035pe","dp05_0036pe","dp05_0037pe","dp05_0038pe","dp05_0039pe","dp05_0040pe","dp05_0041pe","dp05_0042pe","dp05_0043pe","dp05_0044pe","dp05_0045pe","dp05_0046pe","dp05_0047pe","dp05_0048pe","dp05_0049pe","dp05_0050pe","dp05_0051pe","dp05_0052pe","dp05_0053pe","dp05_0054pe","dp05_0055pe","dp05_0056pe","dp05_0057pe","dp05_0058pe","dp05_0059pe","dp05_0060pe","dp05_0061pe","dp05_0062pe","dp05_0063pe","dp05_0064pe","dp05_0065pe","dp05_0066pe","dp05_0067pe","dp05_0068pe","dp05_0069pe","dp05_0070pe","dp05_0071pe","dp05_0072pe","dp05_0073pe","dp05_0074pe","dp05_0075pe","dp05_0076pe","dp05_0077pe","dp05_0078pe","dp05_0079pe","dp05_0080pe","dp05_0081pe","dp05_0082pe","dp05_0083pe","dp05_0084pe","dp05_0085pe","dp05_0086pe","dp05_0087pe","dp05_0088pe","dp05_0089pe","dp05_0090pe","dp05_0091pe"];
  const random = Math.floor(Math.random() * columns.length);
  const column = columns[random];

  // title
  var title = new L.tooltip({
    permanent: true,
    offset:[0,0],
    opacity:1,
    direction:'top',
    className:'mytitle'
  }).setContent().setLatLng(new L.LatLng(49,-98)).addTo(feature_cover);

  // subtitle
  var title = new L.tooltip({
    permanent: true,
    offset:[0,0],
    opacity:1,
    direction:'bottom',
    className:'mysubtitle'
  }).setContent().setLatLng(new L.LatLng(25,-98)).addTo(feature_cover);

  // circleMarker
  function myCirclemarker(feature, latlng) {
    return L.circleMarker(latlng, {
      radius : 4,
      fillColor : "#ff7800",
      color : "#000",
      weight : 1,
      opacity : 1,
      fillOpacity : 0.8
    }).bindPopup(feature.properties.amenity);
  }

  // marker
  function myMarker(feature, layer){
    var bounds = layer.getBounds();
    var center = bounds.getCenter();
    var marker = L.marker(center).addTo(layer);
	// zoom on click
    marker.on('click', function(e) {
      map.fitBounds(bounds);      
    });
    layer.bindPopup('<h2>#'+feature.properties.rank+' '+feature.properties.ctyname+'</h2><h3>Pop 2021: '+feature.properties.popestimate2021+'</h3><h3>Pop Change: '+feature.properties.npopchg2021+'</h3><h3>Natural Change Rate: '+feature.properties.rnaturalchg2021+'</h3><h3>Net Migration Rate: '+feature.properties.rnetmig2021+'</h3>');
  }

  // tooltip
  function myTooltip(feature, layer){
    var bounds = layer.getBounds();
    var center = bounds.getCenter();
    var mytooltip = new L.tooltip({
    permanent: true,
    offset:[0,0],
    opacity:1,
    direction:'top',
    className:'myheadline'}).setContent('<h3>'+feature.properties.name+'</h3>').setLatLng(center).addTo(featureGroup1);
    layer.bindPopup('<h3>'+feature.properties.name+'</h3>').addTo(featureGroup2);
  }

  // colors
  function getColor(d) {
    switch (d) {
      case "q1": return "rgba(255,255,178,255)";
      case "q2": return "rgba(254,191,86,255)";
      case "q3": return "rgba(248,108,49,255)";
      case "q4": return "rgba(189,0,38,255)";
    }
  }

  // style
  function quartileStyle(feature) {
    return {
      fillColor: getColor(feature.properties.quartile),
      weight: 0,
      opacity: 1,
      color: 'white',
      fillOpacity: 0.5
    };
  }

  // geojson quartile
  var feature_quartile = L.geoJSON.ajax('https://raw.githubusercontent.com/geographyclub/american-geography/main/geojson/state/state_quartile_'+column+'.geojson', {
    interactive:false,
    style:quartileStyle
  }).addTo(map)

  // base layers
  //var german = L.TileLayer('https://{s}.tile.openstreetmap.de/{z}/{x}/{y}.png', {noWrap:false});
  //var french = L.TileLayer('http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {noWrap:false});
  var streets = new L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {noWrap:false, attribution:'<a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>', lang:'en'}).addTo(map);
  var satellite = new L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {id: 'mapbox/satellite-v9', tileSize: 512, zoomOffset: -1, attribution:'<a href="https://www.mapbox.com/">Mapbox</a>'});

  // layer switcher
  map.addLayer(feature_cover)
  var baseMaps = {"Streets":streets};
  var overlayMaps = {"Overlay":feature_quartile};
  L.control.layers(baseMaps,overlayMaps).addTo(map);

  // navbar
  L.control.navbar().addTo(map);
};
window.onload = map();

// footer
jQuery('.leaflet-bottom.leaflet-left').html('<a href="mailto:emailstevekim@gmail.com">emailstevekim@gmail.com</a>');
//jQuery('.leaflet-bottom.leaflet-right').html('');


</script>
</body>
</html>

