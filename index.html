<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>American Geography</title>

<!-- load styles -->
<link rel="icon" type="image/png" href="favicon.png">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
  crossorigin=""/>
<link rel="stylesheet" href="style.css">

<!-- load scripts -->
<script
  src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
  integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="
  crossorigin="anonymous"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
  integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
  crossorigin=""></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
</head>
<body>

<div id="map"></div>

<!-- start scripts -->
<script>
// create map
var map;

function map(){
  map = L.map('map', {maxZoom:16});
  map.setMaxBounds([[20, -130], [50, -60]]);
  map.setMinZoom(map.getBoundsZoom([[20, -130], [50, -60]], true));
  map.setView([39, -98], 5);

  // featuregroups
  var featureGroup1 = new L.featureGroup()
  var featureGroup2 = new L.featureGroup()

  // style
  function style(feature) {
    return {
      weight:1
    };
  }

  // title
  var title = new L.tooltip({
    permanent: true,
    offset:[0,0],
    opacity:1,
    direction:'top',
    className:'myTitle'
  }).setContent('<h1>AMERICAN GEOGRAPHY</h1><h3>~BLOGGING CENSUS AND STREET DATA~</h3>').setLatLng(new L.LatLng(45,-98)).addTo(featureGroup1);

  // headlines
  function bindDivIcon(feature, layer){
    var bounds = layer.getBounds();
    var center = bounds.getCenter();
    var mytooltip = new L.tooltip({
    permanent: true,
    offset:[0,0],
    opacity:1,
    direction:'top',
    className:'myHeadline'}).setContent('<h2>'+feature.properties.name+'</h2>').setLatLng(center).addTo(featureGroup1);
    layer.bindPopup('<h1>'+feature.properties.name+'</h1>').addTo(featureGroup2);
  }

  // get geojson features
  var featureGroup2 = L.geoJSON.ajax('https://raw.githubusercontent.com/geographyclub/american-geography/main/data/test.geojson', {
	style:style,
	onEachFeature:bindDivIcon
  }).addTo(map)
 
  // base layers
  //var german = L.TileLayer('https://{s}.tile.openstreetmap.de/{z}/{x}/{y}.png', {noWrap:false});
  //var french = L.TileLayer('http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {noWrap:false});
  var streets = new L.TileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {noWrap:false, attribution:'<a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map);
  var satellite = new L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {id: 'mapbox/satellite-v9', tileSize: 512, zoomOffset: -1, attribution:'<a href="https://www.mapbox.com/">Mapbox</a>'});

  // layer switcher
  map.addLayer(featureGroup1)
  var baseMaps = {"Streets":streets, "Satellite":satellite};
  var overlayMaps = {"Headlines":featureGroup1, "Features":featureGroup2};
  L.control.layers(baseMaps,overlayMaps).addTo(map);

};
window.onload = map();

// footer
jQuery('.leaflet-bottom.leaflet-left').html('<a href="mailto:emailstevekim@gmail.com">emailstevekim@gmail.com</a>');
//jQuery('.leaflet-bottom.leaflet-right').html('');


/* misc
  function myIcon(feature, layer){
    var bounds = layer.getBounds();
    var center = bounds.getCenter();
//    var mypopup = layer.bindPopup('<h1>'+feature.properties.name+'</h1>').addTo(featureGroup2);
    var marker = L.marker(center, {
      icon: new L.DivIcon({
        draggable:'false',
        iconAnchor:center,
        popupAnchor:center,
        className:'myDivIcon',
        html:'<h2>'+feature.properties.name+'</h2>'
      })
    }).addTo(featureGroup1);
  }

function bindMarker(feature, layer){
  var bounds = layer.getBounds();
  var center = bounds.getCenter();
  var marker = L.marker(center).addTo(map).bindPopup("Test Label");
}

//click on group
  featureGroup2.on('click', function(e){
    e.target.openPopup();
  });
//click on map
  map.on('click', clickAnywhere);

// get data on click
var popup = L.popup();
var id; var lat; var lon; var x; var y;
function clickAnywhere(e){
  var bbox = e.target.getBounds().toBBoxString();
  x = e.latlng.lat.toFixed(2);
  y = e.latlng.lng.toFixed(2);
  jQuery.post("/weather/get_weather.php", {"x":x, "y":y}).done(function(data){
    id = data.split(',')[0]
    lat = data.split(',')[1]
    lon = data.split(',')[2]
    var temp = data.split(',')[3]
    var content = "<div id='content'><p>CURRENT TEMP: "+temp+"°C</p><hr/><p>CLICK COORD: "+x+"°, "+y+"°</p><p>STATION COORD: "+lat+"°, "+lon+"°</p></div>";
    popup.setLatLng(e.latlng).setContent(content).openOn(map);
  });
};

// geolocate
function onLocationFound(e){
  var radius = e.accuracy / 2;
  L.circle(e.latlng, radius, {weight:1}).addTo(map);
  L.circle(e.latlng, 1).addTo(map);
}
function onLocationError(e){
  console.log(e.message);
}
map.on('locationerror', onLocationError);
map.on('locationfound', onLocationFound);
map.locate({setView: true, zoom: 2});

*/



</script>
</body>
</html>

