<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>American Geography</title>

<!-- load scripts -->
<script
  src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
  integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="
  crossorigin="anonymous"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
  integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
  crossorigin=""></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
<script src="js/Leaflet.NavBar-master/src/Leaflet.NavBar.js"></script>
<script src="js/leaflet-simple-map-screenshoter-master/dist/leaflet-simple-map-screenshoter.js"></script>

<!-- load styles -->
<link rel="icon" type="image/png" href="favicon.png">
<link href="https://fonts.googleapis.com/css?family=Montserrat:600,900" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
  integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
  crossorigin=""/>
<link rel="stylesheet" href="js/Leaflet.NavBar-master/src/Leaflet.NavBar.css"></link>
<link rel="stylesheet" href="style.css">

</head>
<body>

<div id="map"></div>
<div id="info"></div>

<!-- start scripts -->
<script>
// create map
var map;

function map(){
  map = L.map('map', {maxZoom:18});
  map.setMaxBounds([[-90, -180], [90, 180]]);
  map.setMinZoom(map.getBoundsZoom([[29, -128], [49, -68]], false));
  map.setView([39, -98], 1);

  // featuregroups
  var featureGroup1 = new L.featureGroup()
  var featureGroup2 = new L.featureGroup()

  // title
  var title = new L.tooltip({
    permanent: true,
    offset:[0,0],
    opacity:1,
    direction:'top',
    className:'mytitle'
  }).setContent('<h1>AMERICAN GEOGRAPHY</h1><h3>CENSUS AND STREET DATA</h3>').setLatLng(new L.LatLng(52,-98)).addTo(featureGroup1);

  // subtitle
  var title = new L.tooltip({
    permanent: true,
    offset:[0,0],
    opacity:1,
    direction:'bottom',
    className:'mysubtitle'
  }).setContent('<h2>COUNTY TRENDS EDITION</h2>').setLatLng(new L.LatLng(24,-98)).addTo(featureGroup1);

  // circleMarker
  function mycirclemarker(feature, latlng) {
    return L.circleMarker(latlng, {
      radius : 4,
      fillColor : "#ff7800",
      color : "#000",
      weight : 1,
      opacity : 1,
      fillOpacity : 0.8
    }).bindPopup(feature.properties.amenity);
  }

  // marker
  function mymarker(feature, layer){
    var bounds = layer.getBounds();
    var center = bounds.getCenter();
    var marker = L.marker(center).addTo(featureGroup1);
	// zoom on click
    marker.on('click', function(e) {
      map.fitBounds(bounds);      
    });  
    layer.bindPopup('<h2>'+feature.properties.name+'</h2><h3>'+feature.properties.myvar+': '+feature.properties.myvalue+'</h3>').addTo(map); 
  }

  // tooltip
  function mytooltip(feature, layer){
    var bounds = layer.getBounds();
    var center = bounds.getCenter();
    var mytooltip = new L.tooltip({
    permanent: true,
    offset:[0,0],
    opacity:1,
    direction:'top',
    className:'myheadline'}).setContent('<h3>'+feature.properties.name+'</h3>').setLatLng(center).addTo(featureGroup1);
    layer.bindPopup('<h3>'+feature.properties.name+'</h3>').addTo(featureGroup2);
  }

  // colors
  function getcolor(d) {
    switch (d) {
      case "q1": return "#2b83ba";
      case "q2": return "#abdda4";
      case "q3": return "#fdae61";
      case "q4": return "#d7191c";
    }
  }

  // style
  function style(feature) {
    return {
      fillColor: getcolor(feature.properties.quartile),
      weight: 0,
      opacity: 1,
      color: 'white',
      fillOpacity: 0.5
    };
  }

  // county pop2021
  var pop2020 = L.geoJSON.ajax('https://raw.githubusercontent.com/geographyclub/american-geography/main/data/county_pop2020_quartile.geojson', {
    interactive:false,
    style:style
  }).addTo(map)

  // county npopchg2021
  var npopchg2021 = L.geoJSON.ajax('https://raw.githubusercontent.com/geographyclub/american-geography/main/data/county_popestimate2021_quartile.geojson', {
    interactive:false,
    style:style
  })

  // county rnaturalchg2021
  var rnaturalchg2021 = L.geoJSON.ajax('https://raw.githubusercontent.com/geographyclub/american-geography/main/data/county_rnaturalchg2021_quartile.geojson', {
    interactive:false,
    style:style
  })

  // county rnetmig2021
  var rnetmig2021 = L.geoJSON.ajax('https://raw.githubusercontent.com/geographyclub/american-geography/main/data/county_rnetmig2021_quartile.geojson', {
    interactive:false,
    style:style
  })


  // base layers
  //var german = L.TileLayer('https://{s}.tile.openstreetmap.de/{z}/{x}/{y}.png', {noWrap:false});
  //var french = L.TileLayer('http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {noWrap:false});
  var streets = new L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {noWrap:false, attribution:'<a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map);
  var satellite = new L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {id: 'mapbox/satellite-v9', tileSize: 512, zoomOffset: -1, attribution:'<a href="https://www.mapbox.com/">Mapbox</a>'});

  // layer switcher
  map.addLayer(featureGroup1)
  var baseMaps = {"Streets":streets, "Satellite":satellite};
  var overlayMaps = {"Title":featureGroup1, "Pop 2020":pop2020, "Pop Change 2021":npopchg2021, "Natural Change Rate 2021":rnaturalchg2021, "Net Migration Rate 2021":rnetmig2021};
  L.control.layers(baseMaps,overlayMaps).addTo(map);

  // navbar
  L.control.navbar().addTo(map);

  // screenshoter
  L.simpleMapScreenshoter().addTo(map)

};
window.onload = map();

// footer
jQuery('.leaflet-bottom.leaflet-left').html('<a href="mailto:emailstevekim@gmail.com">emailstevekim@gmail.com</a>');
//jQuery('.leaflet-bottom.leaflet-right').html('');

// style screenshoter
$(window).on('load', function() {
  $('.leaflet-control-simpleMapScreenshoter').css('border', '0');
});


/* misc

  // geojson with popup
  var pop2020 = L.geoJSON.ajax('https://raw.githubusercontent.com/geographyclub/american-geography/main/data/county_pop2020_quartile.geojson', {
  style:style,
  onEachFeature:function mymarker(feature, layer){
      layer.bindPopup('<h3>Min: '+feature.properties.min+'</h3><h3>Max: '+feature.properties.max+'</h3>').addTo(map);
    }
  }).addTo(map)

  // get geojson polygons with markers
  var featureGroup2 = L.geoJSON.ajax('https://raw.githubusercontent.com/geographyclub/american-geography/main/data/county_pop2020_quartile.geojson', {
  style:style,
  onEachFeature:mymarker
  }).addTo(map)

  // get geojson points
  var featureGroup3 = L.geoJSON.ajax('https://raw.githubusercontent.com/geographyclub/american-geography/main/data/points.geojson', {
  pointToLayer:mycirclemarker
  })


// marker with popup
var marker = L.marker(center).addTo(featureGroup1).bindPopup('<h3>'+feature.properties.name+'</h3>').addTo(map);

// print all json data
'<pre>'+JSON.stringify(feature.properties,null,' ').replace(/[\{\}"]/g,'')+'</pre>'

var ico = L.icon({
  iconUrl: 'https://api2.datamap.bg/images/blue_icon.png',
  iconSize: [25, 25],
  iconAnchor: [15, 15],
  popupAnchor: [-10, -10]
});

function mydivicon(feature, layer){
  var bounds = layer.getBounds();
  var center = bounds.getCenter();
  var mypopup = layer.bindPopup('<h1>'+feature.properties.name+'</h1>').addTo(featureGroup2);
  var marker = L.marker(center, {
    icon: new L.DivIcon({
      draggable:'false',
      iconAnchor:center,
      popupAnchor:center,
      className:'myDivIcon',
      html:'<h2>'+feature.properties.name+'</h2>'
    })
  }).addTo(featureGroup1);
}

// click on layer
featureGroup2.on('click', function(e){
  e.target.openPopup();
});

// click on map
map.on('click', clickAnywhere);

// get php data
var popup = L.popup();
var id; var lat; var lon; var x; var y;
function clickAnywhere(e){
  var bbox = e.target.getBounds().toBBoxString();
  x = e.latlng.lat.toFixed(2);
  y = e.latlng.lng.toFixed(2);
  jQuery.post("/weather/get_weather.php", {"x":x, "y":y}).done(function(data){
    id = data.split(',')[0]
    lat = data.split(',')[1]
    lon = data.split(',')[2]
    var temp = data.split(',')[3]
    var content = "<div id='content'><p>CURRENT TEMP: "+temp+"°C</p><hr/><p>CLICK COORD: "+x+"°, "+y+"°</p><p>STATION COORD: "+lat+"°, "+lon+"°</p></div>";
    popup.setLatLng(e.latlng).setContent(content).openOn(map);
  });
};

// geolocate
function onLocationFound(e){
  var radius = e.accuracy / 2;
  L.circle(e.latlng, radius, {weight:1}).addTo(map);
  L.circle(e.latlng, 1).addTo(map);
}
function onLocationError(e){
  console.log(e.message);
}
map.on('locationerror', onLocationError);
map.on('locationfound', onLocationFound);
map.locate({setView: true, zoom: 2});

*/



</script>
</body>
</html>

