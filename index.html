<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,600,900" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Montserrat:300,600,900" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Pacifico" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<title>American Geography</title>
</head>
<body>

<header>
<div><a href="#"><h1 style="font-size:16px;"><span style="font-weight:600">american</span><span style="font-family:'Pacifico'">geography</span></h1></a></div>
<div class="menu-icon">&#9776;</div>
<nav>
<a href="#" onclick="closeMenu()">Home</a>
<a href="https://geographyclub.github.io/asean/" target="_blank">Asean Primer</a>
<!--<a href="#" onclick="scrollToSection('Brunei');">Brunei</a>-->
</nav>
</header>

<div class="container">
  <div class="flex-container"><div class="flex-column-wide color-gradient" style="padding:10px 0"><h1 style="font-size:20px; line-height:0.8; letter-spacing:-1px;"><span style="font-size:60px; line-height:0.2">10</span><br>Random stats from<br><a href="https://www.cia.gov/the-world-factbook/" target="_blank">The US Census</a></h1></div></div>
  <div class="flex-container" id="resultContainer"></div>
</div>

<!--<div class="border-container"><div class="color-block"></div><div class="color-block"></div><div class="color-block"></div></div>-->

<script>
let counterValue = 1;
// Fetch JSON
function fetchCodes() {
  const labelsUrl = 'https://raw.githubusercontent.com/geographyclub/american-geography/main/json/DP02_labels.json';
  return fetch(labelsUrl)
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      // Assign the parsed JSON data to the 'codes' variable
      return data;
    })
    .catch(error => {
      console.error('Error fetching the file:', error);
    });
}

function fetchData() {
  // Call the function to fetch 'codes'
  return fetchCodes()
    .then(codes => {
      // Assuming you have the list of file names in the 'files' array
<!-- ls -1 | sed -e 's/^/"/g' -e 's/$/"/g' | paste -sd, -->
var files = ["alabama.json","alaska.json","arizona.json","arkansas.json","california.json","colorado.json","connecticut.json","delaware.json","districtofcolumbia.json","florida.json","georgia.json","hawaii.json","idaho.json","illinois.json","indiana.json","iowa.json","kansas.json","kentucky.json","louisiana.json","maine.json","maryland.json","massachusetts.json","michigan.json","minnesota.json","mississippi.json","missouri.json","montana.json","nebraska.json","nevada.json","newhampshire.json","newjersey.json","newmexico.json","newyork.json","northcarolina.json","northdakota.json","ohio.json","oklahoma.json","oregon.json","pennsylvania.json","puertorico.json","rhodeisland.json","southcarolina.json","southdakota.json","tennessee.json","texas.json","unitedstatesvirginislands.json","utah.json","vermont.json","virginia.json","washington.json","westvirginia.json","wisconsin.json","wyoming.json"]

      // Generate a random index to pick a random file
      var randomIndex = Math.floor(Math.random() * files.length);
      var randomFile = files[randomIndex];
      var jsonFileUrl = `https://raw.githubusercontent.com/geographyclub/american-geography/main/json/states/DP02_${randomFile}`;

      // Extract the filename from the URL
      var filename = jsonFileUrl.substring(jsonFileUrl.lastIndexOf('/') + 1);

      // Fetch the random JSON file
      return fetch(jsonFileUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.json();
        })
        .then(jsonData => {
          // Assuming the JSON data is an array of objects
          if (Array.isArray(jsonData) && jsonData.length > 0) {
            // Pick a random object from the array
            var randomObjectIndex = Math.floor(Math.random() * jsonData.length);
            var randomObject = jsonData[randomObjectIndex];

            // Get an array of property names from the random object
            var propertyNames = Object.keys(randomObject);

            // Initialize variables for random property and value
            var randomPropertyName, randomValue;

            // Pick a random property name and value, ensuring it's not null or "(X)"
            do {
              var randomPropertyNameIndex = Math.floor(Math.random() * propertyNames.length);
              randomPropertyName = propertyNames[randomPropertyNameIndex];
              randomValue = randomObject[randomPropertyName];
            } while (randomValue === null || randomValue === "(X)");

            // Convert the entire random property name to uppercase
            randomPropertyName = randomPropertyName.toUpperCase();

            console.log(`Random Property: ${randomPropertyName}, Random Value: ${randomValue}, File: ${filename}`);

            // Find the matching code in the 'codes' array
            var matchingCode = codes.find(code => code.code === randomPropertyName);

            // Check if a matching code is found
            if (matchingCode) {
              // Get the corresponding label from the matching code
              var matchingCodeLabel = matchingCode.label;

              console.log(`Matching Code Label: ${matchingCodeLabel}`);

              // Split the matching code label by '!!'
              var labelParts = matchingCodeLabel.split('!!');

              // Access all remaining parts starting from labelParts[2]
              var remainingParts = labelParts.slice(2);

              console.log('Remaining Parts:', remainingParts);

              // Fetch the data from another file using the matching value
              return fetchAnotherFile(randomValue, remainingParts);
            } else {
              console.log('No matching code found.');
            }
          } else {
            throw new Error(`Invalid JSON format in file: ${filename}`);
          }
        });
    })
    .catch(error => {
      console.error(`Error fetching or processing data: ${error.message}`);
    });
}

function fetchAnotherFile(matchingValue, remainingParts) {
  // Assuming the URL to the other file contains the matching value
  var anotherFileUrl = 'https://raw.githubusercontent.com/geographyclub/american-geography/main/json/us/DP02_us.json';

  return fetch(anotherFileUrl)
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      return response.json();
    })
    .then(anotherData => {
      // Search inside the JSON data for the matching value and remaining parts
      var matchingItem = anotherData.find(item => item.name === matchingValue);

      if (matchingItem) {
        console.log('Matching Item:', matchingItem);

        // Extract additional values based on remainingParts
        var additionalValues = remainingParts.reduce((result, part) => {
          result[part.toLowerCase()] = matchingItem[part];
          return result;
        }, {});

        console.log('Additional Values:', additionalValues);

        return {
          matchingItem: matchingItem,
          additionalValues: additionalValues
        };
      } else {
        console.log('No matching item found.');
      }
    })
    .catch(error => {
      console.error('Error fetching data from another file:', error);
    });
counterValue += 1;
}

const numberOfFetches = 10;
for (let i = 0; i < numberOfFetches; i++) {
  fetchData();
}

</script>

<!-- close menu -->
<script>
document.querySelector('.menu-icon').addEventListener('click', function () {
document.querySelector('nav').classList.toggle('show');
});
function closeMenu() {
document.querySelector('nav').classList.remove('show');
}
</script>

<!-- scroll to section with offset -->
<script>
function scrollToSection(sectionId) {
const targetSection = document.getElementById(sectionId);
const offset = 50;

if (targetSection) {
window.scrollTo({
top: targetSection.offsetTop - offset,
behavior: 'smooth'
});
}
event.preventDefault();
closeMenu();
}
</script>

</body>
</html>
